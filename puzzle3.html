<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reto - Puzzle Deslizante</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        .board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 4px;
            margin: var(--spacing-lg) auto;
            width: 308px;
            height: 308px;
            padding: 4px;
            background-color: var(--color-bg-primary);
            border-radius: var(--radius-md);
            border: 2px solid var(--color-text-secondary);
        }

        .tile {
            width: 100px;
            height: 100px;
            background-image: url('photo.jpeg');
            background-size: 300px 300px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border-radius: var(--radius-sm);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            position: relative;
            user-select: none;
            -webkit-user-select: none;
        }

        .tile:not(.empty):hover {
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .tile:not(.empty):active {
            transform: scale(0.98);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            cursor: grabbing;
        }

        .empty {
            background: var(--color-bg-secondary);
            cursor: default;
            transition: background-color 0.2s ease;
        }

        .tile.movable {
            position: relative;
        }

        .tile.movable::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 2px solid var(--color-accent-primary);
            border-radius: var(--radius-sm);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .tile.movable:hover::after {
            opacity: 1;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-links">
                
            </div>
        </div>
    </nav>

    <main class="container">
        <div class="puzzle-container fade-in">
            <h1 class="puzzle-title">Reto â€” Reconstruye la Foto</h1>
            <p class="puzzle-description">
                Reordena las piezas para restaurar la foto original. Solo puedes mover una pieza a la vez 
                (hacia el espacio vacÃ­o).
            </p>

            <div class="board" id="board"></div>

            <div id="clue3" class="clue hidden"></div>
            <div id="celebration"
                style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:9999;"></div>
            <div id="sparkle-layer"
                style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:10000;"></div>
            
            </div>
        </div>
    </main>

<script>
    const board = document.getElementById('board');
    const size = 3;
    const tiles = [];
    let boardState = []; // Holds the current order of tile indices
    let emptyIndex = size * size - 1; // Last one is empty

    // Generate tiles
    for (let i = 0; i < size * size; i++)
    {
        const tile = document.createElement('div');
        tile.classList.add('tile');
        if (i === emptyIndex)
        {
            tile.classList.add('empty');
        } else
        {
            const x = (i % size) * -100;
            const y = Math.floor(i / size) * -100;
            tile.style.backgroundPosition = `${x}px ${y}px`;
            tile.dataset.correct = i;
        }
        tiles.push(tile);
        board.appendChild(tile);
    }

    // Initialize board state
    boardState = [...Array(size * size).keys()];

    // Shuffle board
    shuffle();

    // Handle clicks
    board.addEventListener('click', (e) =>
    {
        const clickedTile = e.target;
        if (clickedTile.classList.contains('empty')) return;

        const tileIndex = boardState.indexOf(parseInt(clickedTile.dataset.correct));
        if (isMovable(tileIndex))
        {
            moveTile(tileIndex);
            checkWinCondition();
        }
    });

    // Determine if a tile can move
    function isMovable(tileIndex)
    {
        const tileRow = Math.floor(tileIndex / size);
        const tileCol = tileIndex % size;
        const emptyRow = Math.floor(emptyIndex / size);
        const emptyCol = emptyIndex % size;

        return (
            (tileRow === emptyRow && Math.abs(tileCol - emptyCol) === 1) ||
            (tileCol === emptyCol && Math.abs(tileRow - emptyRow) === 1)
        );
    }

    // Move tile
    function moveTile(tileIndex)
    {
        // Swap in boardState
        [boardState[tileIndex], boardState[emptyIndex]] = [boardState[emptyIndex], boardState[tileIndex]];
        emptyIndex = tileIndex;

        // Redraw board
        board.innerHTML = '';
        for (let i = 0; i < boardState.length; i++)
        {
            board.appendChild(tiles[boardState[i]]);
        }
    }

    // Shuffle until solvable
    function shuffle()
    {
        do
        {
            boardState = [...Array(size * size).keys()];
            for (let i = boardState.length - 2; i > 0; i--)
            {
                const j = Math.floor(Math.random() * (i + 1));
                [boardState[i], boardState[j]] = [boardState[j], boardState[i]];
            }
        } while (!isSolvable(boardState));

        emptyIndex = boardState.indexOf(size * size - 1);
        board.innerHTML = '';
        for (let i = 0; i < boardState.length; i++)
        {
            board.appendChild(tiles[boardState[i]]);
        }
    }

    // Check if solvable (3x3)
    function isSolvable(arr)
    {
        const invArr = arr.filter(x => x !== size * size - 1);
        let invCount = 0;
        for (let i = 0; i < invArr.length; i++)
        {
            for (let j = i + 1; j < invArr.length; j++)
            {
                if (invArr[i] > invArr[j]) invCount++;
            }
        }
        return invCount % 2 === 0;
    }

    // Check win
    function checkWin()
    {
        for (let i = 0; i < boardState.length - 1; i++)
        {
            if (boardState[i] !== i) return false;
        }
        return true;
    }

    function checkWinCondition()
    {
        if (checkWin()) {
                           // Celebration animation
            const celebration = document.getElementById('celebration');
            const sparkleLayer = document.getElementById('sparkle-layer');
            celebration.innerHTML = '';
            sparkleLayer.innerHTML = '';
            celebration.style.display = 'block';
            sparkleLayer.style.display = 'block';

            // Create a background glow effect
            const glow = document.createElement('div');
            glow.style.position = 'fixed';
            glow.style.top = '0';
            glow.style.left = '0';
            glow.style.width = '100vw';
            glow.style.height = '100vh';
            glow.style.background = 'radial-gradient(circle at center, rgba(255,182,193,0.2) 0%, rgba(255,182,193,0) 70%)';
            glow.style.opacity = '0';
            celebration.appendChild(glow);
            glow.animate([
                { opacity: 0 },
                { opacity: 1 },
                { opacity: 0 }
            ], {
                duration: 3000,
                easing: 'ease-in-out'
            });

            // Floating hearts with trails
            const heartEmojis = ['ðŸ’–', 'â¤ï¸', 'ðŸ’', 'ðŸ’•', 'ðŸ’—'];
            for (let i = 0; i < 24; i++)
            {
                const heart = document.createElement('div');
                heart.innerHTML = heartEmojis[Math.floor(Math.random() * heartEmojis.length)];
                heart.style.position = 'absolute';
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.top = (Math.random() * 30 + 70) + 'vh';
                heart.style.fontSize = (Math.random() * 2.5 + 1.2) + 'em';
                heart.style.opacity = (Math.random() * 0.4 + 0.6).toFixed(2);
                heart.style.filter = 'blur(0.2px)';
                celebration.appendChild(heart);

                // Create heart trail
                const trail = document.createElement('div');
                trail.style.position = 'absolute';
                trail.style.left = heart.style.left;
                trail.style.top = heart.style.top;
                trail.style.fontSize = heart.style.fontSize;
                trail.innerHTML = heart.innerHTML;
                trail.style.opacity = '0.3';
                trail.style.filter = 'blur(2px)';
                celebration.appendChild(trail);

                const duration = 2500 + Math.random() * 1000;
                const floatY = -70 - Math.random() * 30;
                const floatX = (Math.random() - 0.5) * 40;

                heart.animate([
                    { transform: 'translate(0, 0) scale(1) rotate(0deg)', opacity: heart.style.opacity },
                    { transform: `translate(${floatX}px, ${floatY}vh) scale(1.2) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                ], {
                    duration: duration,
                    easing: 'ease-out',
                    fill: 'forwards'
                });

                trail.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: '0.3', filter: 'blur(2px)' },
                    { transform: `translate(${floatX * 0.7}px, ${floatY * 0.7}vh) scale(0.8)`, opacity: 0, filter: 'blur(4px)' }
                ], {
                    duration: duration * 0.8,
                    easing: 'ease-out',
                    fill: 'forwards'
                });
            }

            // Sparkles with color variation
            const sparkleColors = ['#FFD700', '#FF69B4', '#87CEEB', '#DDA0DD'];
            for (let i = 0; i < 40; i++)
            {
                const sparkle = document.createElement('div');
                sparkle.style.position = 'absolute';
                sparkle.style.width = (Math.random() * 4 + 3) + 'px';
                sparkle.style.height = sparkle.style.width;
                sparkle.style.background = sparkleColors[Math.floor(Math.random() * sparkleColors.length)];
                sparkle.style.borderRadius = '50%';
                sparkle.style.left = Math.random() * 100 + 'vw';
                sparkle.style.top = Math.random() * 100 + 'vh';
                const glowColor = sparkle.style.background.replace(')', ', 0.8)').replace('rgb', 'rgba');
                sparkle.style.boxShadow = `0 0 10px ${glowColor}, 0 0 20px ${glowColor}`;
                sparkleLayer.appendChild(sparkle);

                const delay = Math.random() * 1000;
                setTimeout(() =>
                {
                    sparkle.animate([
                        { transform: 'scale(0) rotate(0deg)', opacity: 0 },
                        { transform: 'scale(1) rotate(180deg)', opacity: 1, offset: 0.2 },
                        { transform: 'scale(0) rotate(360deg)', opacity: 0 }
                    ], {
                        duration: 2000,
                        easing: 'cubic-bezier(0.4, 0, 0.2, 1)',
                        fill: 'forwards'
                    });
                }, delay);
            }

            setTimeout(() =>
            {
                celebration.style.display = 'none';
                sparkleLayer.style.display = 'none';
            }, 3500);

            // Show success message with enhanced animation
            const c = document.getElementById('clue3');
            c.classList.remove('hidden');
            c.innerHTML = "Â¡Pieza a pieza, lo lograron! ðŸ’–<br>AsÃ­ como en el amor, todo encaja cuando trabajan juntos.<br><br><b>Password[2]:</b> El nÃºmero del mes que marca la llegada de la primavera y, mÃ¡s importante, su cumpleaÃ±os.";
            c.style.opacity = '0';
            c.style.transform = 'scale(0.9) translateY(20px)';
            c.style.transition = 'all 1.2s cubic-bezier(0.34, 1.56, 0.64, 1)';
            c.style.background = '#1a1a1a';
            c.style.color = '#ffffff';
            c.style.boxShadow = '0 10px 30px rgba(255,182,193,0.3)';
            c.style.border = '2px solid #1a1a1a';
            c.style.padding = '1.5em';
            c.style.borderRadius = '12px';
            setTimeout(() =>
            {
                c.style.opacity = '1';
                c.style.transform = 'scale(1) translateY(0)';
            }, 100);
        }
    }
</script>

</body>
</html>